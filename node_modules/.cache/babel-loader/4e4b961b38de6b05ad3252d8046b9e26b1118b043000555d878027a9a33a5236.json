{"ast":null,"code":"import Reel from'./Reel';class ReelsController{constructor(game,spinTime,spinTimeBetweenReels){this.onStartFns=[];this.onStopCommandFns=[];this.onStopFns=[];this.stopCommandGiven=false;this.reels=[];for(let i=0;i<game.reelsCount;i++){const spinValues=[];for(let k=0;k<1000;k++){spinValues.push(parseInt(Math.random()*game.symbolsCount)+1);}const reel=new Reel({positions:game.reelPositions,spinValues,speed:game.reelsSpeed,useBlurredSymbols:game.hasBlurredSymbols,bounceDepthPerc:0.1,bounceDuration:350,symbolMargin:game.symbolMargin,maskPaddingX:game.maskPaddingX,maskPaddingY:game.maskPaddingY});reel.container.z=3;reel.mask.z=4;game.ticker.add(()=>{reel.render();});game.stage.addChild(reel.container);game.stage.addChild(reel.mask);this.reels.push(reel);}this.reels.forEach(reel=>{reel.rollingTime=0;});this.spinTime=spinTime||350;this.spinTimeBetweenReels=spinTimeBetweenReels||200;game.ticker.add(delta=>{for(let i=0;i<this.reels.length;i++){const reel=this.reels[i];const active=reel.rolling==true||reel.stopping!==false;if(active&&game.betResponse){const reelStopTime=this.spinTime+i*this.spinTimeBetweenReels;if(reel.rollingTime>reelStopTime){reel._stopValues=reel.stopValues;reel.stop();reel.onceStop(function(){reel.stoppedAutomatically=true;});}else{reel.rollingTime+=delta*16.667;}}else{reel.rollingTime=0;}}});}get reelsActive(){return this.reels.some(reel=>reel.rolling==true||reel.stopping!==false);}onStart(fn){this.onStartFns.push(fn);}onceStart(fn){fn.once=true;this.onStart(fn);}onStopCommand(fn){this.onStopCommandFns.push(fn);}onStop(fn){this.onStopFns.push(fn);}onceStop(fn){fn.once=true;this.onStop(fn);}}export default ReelsController;","map":{"version":3,"names":["Reel","ReelsController","constructor","game","spinTime","spinTimeBetweenReels","onStartFns","onStopCommandFns","onStopFns","stopCommandGiven","reels","i","reelsCount","spinValues","k","push","parseInt","Math","random","symbolsCount","reel","positions","reelPositions","speed","reelsSpeed","useBlurredSymbols","hasBlurredSymbols","bounceDepthPerc","bounceDuration","symbolMargin","maskPaddingX","maskPaddingY","container","z","mask","ticker","add","render","stage","addChild","forEach","rollingTime","delta","length","active","rolling","stopping","betResponse","reelStopTime","_stopValues","stopValues","stop","onceStop","stoppedAutomatically","reelsActive","some","onStart","fn","onceStart","once","onStopCommand","onStop"],"sources":["/home/user/Desktop/Projects/RoyalGames/royalgames-client/src/slot/ReelsController.js"],"sourcesContent":["import Reel from './Reel';\n\nclass ReelsController {\n  onStartFns = [];\n  onStopCommandFns = [];\n  onStopFns = [];\n  stopCommandGiven = false;\n\n  constructor(game, spinTime, spinTimeBetweenReels) {\n    this.reels = [];\n\n    for (let i = 0; i < game.reelsCount; i++) {\n      const spinValues = [];\n      for (let k = 0; k < 1000; k++) {\n        spinValues.push(parseInt(Math.random() * game.symbolsCount) + 1);\n      }\n  \n      const reel = new Reel({\n        positions: game.reelPositions,\n        spinValues,\n        speed: game.reelsSpeed,\n        useBlurredSymbols: game.hasBlurredSymbols,\n        bounceDepthPerc: 0.1,\n        bounceDuration: 350,\n        symbolMargin: game.symbolMargin,\n        maskPaddingX: game.maskPaddingX,\n        maskPaddingY: game.maskPaddingY,\n      });\n      reel.container.z = 3;\n      reel.mask.z = 4;\n\n      game.ticker.add(() => {\n        reel.render();\n      });\n\n      game.stage.addChild(reel.container);\n      game.stage.addChild(reel.mask);\n      this.reels.push(reel);\n    }\n  \n    this.reels.forEach((reel) => {\n      reel.rollingTime = 0;\n    });\n\n    this.spinTime = spinTime || 350;\n    this.spinTimeBetweenReels = spinTimeBetweenReels || 200;\n  \n    game.ticker.add((delta) => {\n      for (let i = 0; i < this.reels.length; i++) {\n        const reel = this.reels[i];\n        const active = reel.rolling == true || reel.stopping !== false;\n  \n        if (active && game.betResponse) {\n          const reelStopTime = this.spinTime + (i * this.spinTimeBetweenReels);\n          if (reel.rollingTime > reelStopTime) {\n            reel._stopValues = reel.stopValues;\n            reel.stop();\n            reel.onceStop(function() {\n              reel.stoppedAutomatically = true;\n            });\n          } else {\n            reel.rollingTime += delta * 16.667;\n          }\n        } else {\n          reel.rollingTime = 0;\n        }\n      }\n    });\n  }\n\n  get reelsActive() {\n    return this.reels.some((reel) => reel.rolling == true || reel.stopping !== false);\n  }\n\n  onStart(fn) {\n    this.onStartFns.push(fn);\n  }\n\n  onceStart(fn) {\n    fn.once = true;\n    this.onStart(fn);\n  }\n\n  onStopCommand(fn) {\n    this.onStopCommandFns.push(fn);\n  }\n\n  onStop(fn) {\n    this.onStopFns.push(fn);\n  }\n\n  onceStop(fn) {\n    fn.once = true;\n    this.onStop(fn);\n  }\n}\n\nexport default ReelsController;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}